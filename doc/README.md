# 多策略交易跟踪系统 v2.0

一个企业级的多策略交易管理和分析平台，支持动态策略管理、精确财务计算、数据审计跟踪和专业级策略分析。

## 🎯 核心特性

### 🏆 动态策略管理系统
- **策略CRUD**：完全自定义的策略创建、修改、删除功能
- **智能标签系统**：预定义标签（轮动、择时、趋势、套利）+ 自定义标签
- **标签管理**：标签的增删改查，支持复用候选标签
- **策略状态管理**：软删除保护，防止意外删除
- **策略描述**：详细的策略说明和标签展示

### 💰 精确财务计算
- **交易费用管理**：买入和卖出交易费用的完整记录
- **精确盈亏计算**：考虑所有交易费用的准确盈亏计算
- **费用占比分析**：交易费用在交易中的比例统计
- **分批操作支持**：正确处理部分平仓的费用分摊
- **历史数据修正**：自动重新计算历史交易的准确盈亏

### 📝 完整交易记录
- **交易理由记录**：买入理由、卖出理由的详细记录
- **交易日志**：平仓时的交易总结和反思记录
- **全字段修改**：支持修改已平仓交易的所有信息
- **修改历史审计**：完整保留所有修改记录的审计跟踪
- **修改原因**：每次修改必须填写详细的修改原因

### 🔒 企业级数据保护
- **软删除机制**：删除的记录保留在数据库中可恢复
- **批量操作**：支持批量选择和删除交易记录
- **安全确认**：删除和恢复操作的随机确认码保护
- **恢复功能**：专门的已删除记录管理页面
- **永久删除**：清理测试数据的彻底删除功能
- **操作记录**：记录所有删除和恢复操作的完整历史

### 🏆 专业策略评分系统
- **三维评分模型**：胜率(0-10分)、盈亏比(0-10分)、频率(0-8分)
- **智能评级**：完美(≥26分)、优秀(≥23分)、良好(≥20分)、合格(≥18分)
- **可视化展示**：Canvas三角图形实时渲染策略表现
- **多维度分析**：按策略、标的、时间段的灵活筛选
- **排序功能**：按总分、分项得分、统计指标排序
- **实时计算**：动态计算最新评分，无需数据库存储

### 📊 多维度表现分析
- **策略维度**：每个策略的详细表现分析页面
- **标的维度**：横向比较不同策略在同一标的上的表现
- **时间维度**：按年/季度/月分析策略的时效性和趋势
- **最佳策略推荐**：自动识别最适合特定标的或时期的策略
- **趋势图表**：Canvas绘制的平滑策略表现趋势曲线
- **期间统计**：每个时间段的综合统计信息和排名

### 🎨 现代化用户界面
- **响应式设计**：基于Bootstrap 5的现代化界面
- **动态加载**：策略和数据的动态加载和展示
- **视觉反馈**：盈亏颜色编码、加载动画、状态指示
- **交互优化**：直观的操作流程和用户体验
- **专业图表**：三角评分图、趋势图表的专业可视化

## 🚀 快速开始

### 环境要求
- Python 3.9+
- pip包管理器
- 现代浏览器 (Chrome/Firefox/Safari)

### 一键启动

```bash
# 克隆或进入项目目录
cd mirror

# Mac/Linux用户
./start.sh

# Windows用户
start.bat
```

启动后访问：http://127.0.0.1:8383

### 手动启动（可选）

```bash
# 1. 激活虚拟环境
source venv/bin/activate

# 2. 安装依赖（首次运行）
pip install -r requirements.txt

# 3. 启动应用
python3 app.py
```

## 📖 使用指南

### 🎯 策略管理

#### 创建策略
1. 首页点击"策略管理"或"新建策略"
2. 填写策略名称和详细描述
3. 选择相关标签（轮动、择时、趋势、套利）
4. 可创建自定义标签满足特殊需求

#### 管理标签
- 在策略管理页面管理所有标签
- 支持自定义标签的增删改查
- 预定义标签受保护不可删除

### 💼 交易操作

#### 记录买入
1. 点击"新建买入"按钮
2. 选择交易策略（动态加载）
3. 填写标的信息、价格、数量
4. 填写买入理由（可选但建议）
5. 系统自动计算金额和费用

#### 执行卖出
1. 在交易列表找到持仓记录
2. 点击"卖出"按钮
3. 填写卖出信息和卖出理由
4. 填写交易日志（平仓时）
5. 系统自动计算盈亏和费用

### ✏️ 记录修改

#### 修改交易记录
- 仅已平仓交易可修改
- 支持修改所有字段（价格、数量、费用、理由、策略等）
- 必须填写修改原因
- 系统自动记录修改历史

#### 查看修改历史
- 在交易详情页查看完整修改历史
- 显示修改前后对比
- 记录修改时间和原因

### 🗑️ 数据管理

#### 删除记录
- 支持单条删除或批量删除
- 需要输入随机生成的确认码
- 删除的记录进入"已删除记录"页面

#### 恢复记录
- 在"已删除记录"页面选择要恢复的记录
- 支持批量恢复操作
- 恢复操作也需要确认码保护

#### 永久删除
- 清理测试数据的彻底删除功能
- 需要输入"PERMANENTLY DELETE"确认文本
- 操作不可逆，请谨慎使用

### 📊 策略分析

#### 策略评分总览
- 查看所有策略的三维评分
- 三角图形可视化展示
- 支持按得分排序

#### 标的对比分析
- 选择特定标的
- 横向比较不同策略表现
- 自动推荐最佳策略

#### 时间趋势分析
- 按年/季度/月分析策略表现
- 趋势图表显示策略得分变化
- 期间统计和最佳策略推荐

## 💾 数据架构

### 数据库设计

#### 核心业务表
- **trades**: 交易主表，记录每个标的在各策略下的汇总信息
- **trade_details**: 交易明细表，记录每笔买入/卖出操作
- **strategies**: 策略定义表，支持动态策略管理
- **strategy_tags**: 策略标签表，预定义和自定义标签
- **strategy_tag_relations**: 策略标签关系表，多对多关联

#### 审计和保护表
- **trade_modifications**: 交易修改历史表，完整审计跟踪
- **deleted_records**: 删除记录表，软删除和恢复管理

#### 数据特性
- **索引优化**: 所有关键字段建立索引确保查询性能
- **外键约束**: 保证数据一致性和完整性
- **软删除**: 重要数据采用软删除机制保护
- **时间戳**: 所有操作记录时间戳便于审计

### 数据文件
- `database/trading_tracker.db`: SQLite数据库文件，自动创建和维护
- 支持数据库浏览器查看和管理
- 建议定期备份数据库文件

## 🔧 技术架构

### 后端技术栈
- **Flask**: Python轻量级Web框架
- **SQLite**: 嵌入式关系数据库
- **Decimal**: 精确财务计算
- **JSON**: 数据交换格式

### 前端技术栈
- **Bootstrap 5**: 响应式UI框架
- **JavaScript ES6+**: 现代前端交互
- **Canvas API**: 专业图表绘制
- **Fetch API**: 异步数据加载

### 系统特性
- **端口**: 8383
- **架构**: MVC模式
- **数据库**: 关系型设计 + 索引优化
- **安全**: 输入验证 + 确认码保护

## 📁 项目结构

```
mirror/
├── app.py                     # 主应用文件 (2750+ 行)
├── requirements.txt           # Python依赖列表
├── README.md                 # 项目入口说明
├── run_tests.py              # 测试运行脚本
├── start.sh                  # Mac/Linux启动脚本
├── start.bat                 # Windows启动脚本
├── doc/                      # 📖 项目文档目录
│   ├── README.md            # 详细项目说明文档
│   ├── PROGRESS.md          # 开发进度记录
│   ├── REQUIREMENTS.md      # 需求规格说明书
│   └── TESTING.md           # 测试指南文档
├── database/                 # 💾 数据库目录
│   └── trading_tracker.db   # SQLite数据库文件
├── templates/                # 🎨 HTML模板目录
│   ├── base.html            # 基础模板
│   ├── index.html           # 首页 (策略管理入口)
│   ├── trades.html          # 交易列表 (软删除支持)
│   ├── add_buy.html         # 买入页面 (动态策略)
│   ├── add_sell.html        # 卖出页面
│   ├── trade_details.html   # 交易详情 (修改历史)
│   ├── edit_trade.html      # 交易修改页面
│   ├── strategies.html      # 策略管理页面
│   ├── create_strategy.html # 创建策略页面
│   ├── edit_strategy.html   # 编辑策略页面
│   ├── deleted_trades.html  # 已删除记录页面
│   ├── strategy_scores.html # 策略评分总览
│   ├── strategy_detail.html # 策略详情分析
│   ├── symbol_comparison.html # 标的对比分析
│   ├── symbol_detail.html   # 标的详情分析
│   ├── time_comparison.html # 时间对比分析
│   └── time_detail.html     # 时间详情分析
├── static/                  # 🎯 静态资源目录
│   ├── css/
│   │   └── style.css        # 自定义样式
│   └── js/
│       └── app.js           # JavaScript功能
├── tests/                   # 🧪 测试套件目录
│   ├── unit/                # 单元测试
│   │   └── test_trading_tracker.py
│   ├── functional/          # 功能测试
│   │   └── test_trading_workflows.py
│   └── integration/         # 集成测试
│       └── test_system_integration.py
└── venv/                    # 🐍 Python虚拟环境
```

## 🔮 系统能力

### 功能完整度
- ✅ **交易管理**: 买入、卖出、修改、删除、恢复 (100%)
- ✅ **策略管理**: 动态策略、标签系统、CRUD (100%)
- ✅ **财务计算**: 费用处理、盈亏计算、统计分析 (100%)
- ✅ **数据保护**: 软删除、修改审计、数据恢复 (100%)
- ✅ **策略评分**: 三维评分、可视化、多维分析 (100%)
- ✅ **用户界面**: 响应式设计、交互优化、视觉效果 (100%)

### 适用场景
- **个人投资者**: 多策略投资组合管理
- **专业交易员**: 精确的交易记录和分析
- **投资机构**: 策略回测和表现评估
- **量化团队**: 策略开发和优化分析

### 数据规模
- 支持数万笔交易记录
- 无限策略和标签数量
- 完整历史数据保留
- 高性能查询和分析

## ⚠️ 重要注意事项

### 数据安全
1. **定期备份**: 务必定期备份 `database/trading_tracker.db` 文件
2. **数据隐私**: 所有数据保存在本地，确保隐私安全
3. **操作确认**: 删除和恢复操作需要确认码，请妥善保管
4. **修改审计**: 所有修改都有完整记录，保证数据可追溯

### 系统环境
1. **端口要求**: 确保8383端口未被占用
2. **虚拟环境**: 始终在venv环境中运行程序
3. **浏览器兼容**: 推荐使用Chrome、Firefox或Safari
4. **Python版本**: 需要Python 3.9或更高版本

### 操作建议
1. **策略规划**: 建议先规划好策略分类再开始记录
2. **理由记录**: 建议详细记录买入和卖出理由便于回顾
3. **定期分析**: 利用评分系统定期分析策略表现
4. **数据清理**: 可使用永久删除功能清理测试数据

## 🎉 系统状态

### v2.0 版本特性
- 🏆 **企业级功能完整度**
- 📊 **专业级数据分析**
- 🔒 **银行级数据保护**
- 🎨 **现代化用户体验**

### 生产就绪
- ✅ 所有核心功能完整可用
- ✅ 数据完整性和一致性保证
- ✅ 用户体验优化完成
- ✅ 性能和稳定性测试通过

---

## 许可证

本项目采用MIT许可证，详见LICENSE文件。

## 贡献

欢迎提交Issue和Pull Request来改进项目。

## 支持

如有问题或建议，请通过GitHub Issue联系。

---

**多策略交易跟踪系统 v2.0 - 您的专业交易管理伙伴！** 🚀